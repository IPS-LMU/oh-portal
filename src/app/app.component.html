<div id="app" (dragover)="onMissedDrop($event)" (drop)="onMissedDrop($event)">
    <nav class="navbar navbar-expand-md navbar-light">
        <a class="navbar-brand" href="#">OH-Portal v{{AppInfo.version}}</a>
        <span *ngIf="isdevelopment" style="color:red;">
        in Development
         </span>
        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarsExampleDefault"
                aria-controls="navbarsExampleDefault" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>

        <div class="collapse navbar-collapse" id="navbarsExampleDefault">
            <div class="mr-auto bg-info" style="display:flex; flex:auto">
            </div>
            <div class="my-2 my-lg-0" title="Desktop Notifications">
                <span style="vertical-align: middle"> Desktop Notifications</span>
                <i class="fa fa-bell-o" aria-hidden="true" *ngIf="notification.permissionGranted"
                   (click)="notification.permissionGranted = false"></i>
                <i class="fa fa-bell-slash-o" aria-hidden="true" *ngIf="!notification.permissionGranted"
                   (click)="notification.permissionGranted = true"></i>
            </div>
        </div>
    </nav>
    <div *ngIf="showtool" class="row tool-nav">
        <div class="col-3" style="padding:0;">
            <button class="btn btn-primary" (click)="onBackButtonClicked();" style="width:100%;">
                <i class="fa fa-angle-double-left fa-2x" aria-hidden="true"></i>
            </button>
        </div>
        <div class="col-9" style="border-right: 1px solid gray">
            <div class="title">
                <div class="row inner">
                    <ng-container *ngIf="selectedOperation.previousOperation.results.length > 0">
                        {{selectedOperation.name}}: {{selectedOperation.previousOperation.results[0].fullname}}

                        , Language: {{selectedOperation.task.language}}

                        , Audio duration: {{getTime() |time}}

                    </ng-container>
                    <ng-container *ngIf="selectedOperation.previousOperation.results.length < 1">
                        {{selectedOperation.name}}:
                        {{selectedOperation.previousOperation.previousOperation.results[0].fullname}}

                        , Language: {{selectedOperation.task.language}}

                        , Audio duration: {{getTime() | time}}
                    </ng-container>
                </div>
            </div>
        </div>
    </div>
    <div class="row main-row">
        <div *ngIf="sidebarstate !== 'hidden'" [ngClass]="{
            'col-3': sidebarstate !== 'hidden'
        }" id="sidebar">
            <app-proceedings style="height:100%; display:flex; flex-direction:column; flex:auto;"
                             [taskList]="taskService.taskList"
                             [operations]="taskService.operations"
                             [shortstyle]="true"
                             (afterdrop)="onAfterDrop($event)" #proceedings
                             (operationclick)="onOperationClick($event)"
            ></app-proceedings>
        </div>
        <div [ngClass]="{
        'col-9': sidebarstate !== 'hidden',
        'col-12': sidebarstate === 'hidden'
    }" style="height:100%;" id="upper-main">
            <div id="main">
                <ng-container *ngIf="showtool; else showProceedings">
                    <app-tool-loader [url]="tool_url" style="height:100%;" [operation]="selectedOperation"
                                     (datareceived)="onToolDataReceived($event)"></app-tool-loader>
                </ng-container>
                <ng-template #showProceedings>
                    <div class='row proceedings-header'>
                        <div class="col-2">
                            <button class="btn btn-primary" style="width: 100%;display: block"
                                    (click)="onFilesAddButtonClicked()">
                                <i class="fa fa-plus"></i> <span class="d-none d-lg-inline d-xl-inline">ADD FILES</span>
                            </button>
                            <!-- webkitdirectory directory multiple -->
                            <input type="file" multiple class="fileinput" value="Select audio file"
                                   style="display:none;"
                                   #fileinput
                                   (change)="onFileChange($event)"/>
                        </div>
                        <div class="dropdown col-2">
                            <button class="btn btn-secondary dropdown-toggle" type="button" id="dropdownMenuButton"
                                    data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                <ng-container *ngIf="selectedlanguage === null">
                                    {{AppInfo.languages[0].code | uppercase}}
                                    ({{getShortCode(AppInfo.languages[0].code)}}) [{{AppInfo.languages[0].asr}}]
                                </ng-container>
                                <ng-container *ngIf="selectedlanguage !== null">
                                    {{selectedlanguage.name}} ({{getShortCode(selectedlanguage.code)}})
                                    [{{selectedlanguage.asr}}]
                                </ng-container>
                            </button>
                            <div class="dropdown-menu" aria-labelledby="dropdownMenuButton">
                                    <span class="dropdown-item" *ngFor="let lang of AppInfo.languages; let i = index;"
                                          (click)="onASRLangCHanged(lang)">
                                        <ng-container
                                                *ngIf="!(selectedlanguage === null && i === 0) && (selectedlanguage !== lang.code)">
                                            {{lang.name}} ({{getShortCode(lang.code)}}) [{{lang.asr}}]
                                        </ng-container>
                                    </span>
                            </div>
                        </div>
                        <div class="col-4">
                            <div class="status">
                                <ng-container *ngIf="taskService.countRunningTasks() > 0">
                                    {{taskService.countRunningTasks()}} Task(s) running...
                                </ng-container>
                                <ng-container *ngIf="taskService.countRunningTasks() < 1">
                                    Ready for processing
                                </ng-container>
                            </div>
                        </div>
                        <div class="col-1"></div>
                        <div class="col-3">
                            <button class="btn btn-primary" style="width:100%;" (click)="onUploadButtonClick()"
                                    [disabled]="!newfiles">
                                <i class="fa fa-cloud-upload" aria-hidden="true"></i> <span
                                    class="d-none d-lg-inline d-xl-inline">UPLOAD & PROCESS FILES</span>
                            </button>
                        </div>
                    </div>
                    <app-proceedings style="display:flex; flex:auto;" [taskList]="taskService.taskList"
                                     [operations]="taskService.operations"
                                     (afterdrop)="onAfterDrop($event)" #proceedings
                                     (operationclick)="onOperationClick($event)"
                                     (operationhover)="onOperationHover($event)"
                                     #proceedings
                    ></app-proceedings>
                    <div id="protocol-table" [@expandToggle]="tag.getAttribute('data-state')">
                        <div class="protocol-header">
                            <div class="info">
                                <table>
                                    <tbody>
                                    <tr>
                                        <td (click)="onProtoclLabelClick(tag)">
                                            <div class="errors-td">
                                                <div class="rounded-num" [@blop]="test">{{taskService.errors_count}}
                                                </div>
                                                Errors
                                            </div>
                                        </td>
                                        <td (click)="onProtoclLabelClick(tag)">
                                            <div class="warnings-td">
                                                <div class="rounded-num warning" style="color:black;">
                                                    {{taskService.warnings_count}}
                                                </div>
                                                Warnings
                                            </div>
                                        </td>
                                    </tr>
                                    </tbody>
                                </table>
                            </div>
                            <div class="tag"><i class="fa fa-angle-down" aria-hidden="true" appExpand #tag
                                                style="cursor:pointer;"></i></div>
                        </div>
                        <div class="protocol-body" [ngStyle]="{
                        display: ((tag.getAttribute('data-state') !== 'opened') ? 'none': 'flex')
                    }">
                            <table class="table table-bordered">
                                <tbody>
                                <tr *ngFor="let elem of taskService.protocol_array">
                                    <td>{{elem.task_id}}</td>
                                    <td>
                                        <i *ngIf="elem.state === 'ERROR'" class="fa fa-exclamation"
                                           style="color:red"></i>
                                        <i *ngIf="elem.state === 'FINISHED'" class="fa fa-warning"
                                           style="color:orange"></i>
                                    </td>
                                    <td>{{elem.op_name}}</td>
                                    <td>{{elem.protocol}}</td>
                                </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </ng-template>
            </div>
        </div>
    </div>
</div>