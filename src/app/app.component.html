<app-feedback #feedbackModal></app-feedback>
<app-first-modal #firstModal></app-first-modal>
<app-split-modal #splitModal></app-split-modal>
<app-queue-modal #queueModal [tasks]="taskService.taskList.getAllTasks()" [queue]="taskService.preprocessor.queue"
                 [operations]="taskService.operations"></app-queue-modal>
<div id="app" (dragover)="onMissedDrop($event)" (drop)="onMissedDrop($event)">
    <!-- HEADER -->
    <div class='row proceedings-header' style="background-color: transparent; padding-bottom: 0px;">
        <div class="col-4" style="text-align: center;"><span class="logo">OH-Portal</span> <span class="version">v{{AppInfo.version}}</span>
            <span *ngIf="isdevelopment"
                  style="color:red;">
                in development
            </span>
        </div>
        <div class="col-4 status-div" style="background-color: ghostwhite;">
            <div class="status">
                <ng-container *ngIf="taskService.countRunningTasks() > 0">
                    {{taskService.countRunningTasks()}} Task(s) running...
                </ng-container>
                <ng-container *ngIf="taskService.countRunningTasks() < 1">
                    Ready for processing
                </ng-container>
            </div>
        </div>
        <div class="col-4" style="text-align: center; vertical-align: middle;">
            <div class="row">
                <div class="col-md-3" style="text-align: left; margin-top:10px;">
                    <a style="text-align: left; vertical-align: middle;margin-top:20px;"
                       [href]="taskService.protocolURL" [attr.download]="taskService.protocolFileName"><i
                            class="fa fa-file-code-o"></i> Data</a>
                </div>
                <div class="col-md-3" (click)="feedbackModal.open()"><i
                        class="fa fa-question-circle-o" [ngClass]="{
                        'yellow': !bugService.hasErrors,
                        'red': bugService.hasErrors
                        }"></i>
                </div>
                <div class="col-md-3">
                    <i class="fa fa-bell-o" aria-hidden="true" *ngIf="notification.permissionGranted"
                       (click)="notification.permissionGranted = false"></i>
                    <i class="fa fa-bell-slash-o" aria-hidden="true" *ngIf="!notification.permissionGranted"
                       (click)="notification.permissionGranted = true"></i>
                </div>
                <div class="col-md-3"><i
                        class="fa fa-cog"></i>
                </div>
            </div>
        </div>
    </div>

    <!-- SUB-HEADER OVERVIEW -->
    <div class='row proceedings-header' style="padding-top:0;" *ngIf="!_showtool">
        <div class="col-8" style="text-align: left;border-top: 1px solid cornflowerblue;padding-top:5px;">
            <button class="btn btn-primary" (click)="onFilesAddButtonClicked()">
                <i class="fa fa-plus"></i> <span class="d-none d-lg-inline d-xl-inline">ADD FILES</span>
            </button>
            <!-- webkitdirectory directory multiple -->
            <input type="file" multiple class="fileinput" value="Select audio file"
                   style="display:none;"
                   #fileinput
                   (change)="onFileChange($event)"/>

            <div ngbDropdown class="d-inline-block">
                <button class="btn btn-outline-primary" id="dropdownBasic1" ngbDropdownToggle>
                    <ng-container *ngIf="taskService.selectedlanguage === null">
                        {{AppInfo.languages[0].code | uppercase}}
                        ({{getShortCode(AppInfo.languages[0].code)}}) [{{AppInfo.languages[0].asr}}]
                    </ng-container>
                    <ng-container *ngIf="taskService.selectedlanguage !== null">
                        {{taskService.selectedlanguage.name}} ({{getShortCode(taskService.selectedlanguage.code)}})
                        [{{taskService.selectedlanguage.asr}}]
                    </ng-container>
                </button>
                <div ngbDropdownMenu aria-labelledby="dropdownBasic1">
                    <button class="dropdown-item" *ngFor="let lang of AppInfo.languages; let i = index;"
                            (click)="onASRLangCHanged(lang)">
                        <ng-container
                                *ngIf="!(taskService.selectedlanguage === null && i === 0) && (taskService.selectedlanguage !== lang.code)">
                            {{lang.name}} ({{getShortCode(lang.code)}}) [{{lang.asr}}]
                        </ng-container>
                    </button>
                </div>
            </div>
        </div>
        <div class="col-4" style="text-align:right;border-top: 1px solid cornflowerblue;padding-top:5px;">
            <button class="btn btn-primary" (click)="onUploadButtonClick()"
                    [disabled]="!taskService.newfiles">
                <i class="fa fa-cloud-upload" aria-hidden="true"></i> <span
                    class="d-none d-lg-inline d-xl-inline">UPLOAD & PROCESS FILES</span>
            </button>
        </div>
    </div>

    <!-- SUB-HEADER TOOL -->
    <div class='row proceedings-header' style="padding-top:0px; border-top: 1px solid cornflowerblue; height:50px;"
         *ngIf="_showtool">
        <div class="col-2" style="text-align: left;padding-top:5px;">
            <button class="btn btn-primary" (click)="onBackButtonClicked();" style="width:100%;">
                <i class="fa fa-angle-double-left" aria-hidden="true" style="font-size:20px;"></i>
            </button>
        </div>
        <div class="col-8" style="text-align: center;">
            <p style="margin:0px; margin-top:10px;">
                <ng-container *ngIf="selectedOperation.previousOperation.results.length > 0">
                    {{selectedOperation.name}}: {{selectedOperation.previousOperation.results[0].fullname}}

                    , Language: {{selectedOperation.task.language}}

                    , Audio duration: {{getTime() |time}}

                </ng-container>
                <ng-container *ngIf="selectedOperation.previousOperation.results.length < 1">
                    {{selectedOperation.name}}:
                    {{selectedOperation.previousOperation.previousOperation.results[0].fullname}}

                    , Language: {{selectedOperation.task.language}}

                    , Audio duration: {{getTime() | time}}
                </ng-container>
            </p>
        </div>
        <div class="col-2" style="text-align:right;padding-top:5px;">
            <button class="btn btn-primary" (click)="onBackButtonClicked();" style="width:100%;">
                <i class="fa fa-angle-double-left" aria-hidden="true" style="font-size:20px;"></i>
            </button>
        </div>
    </div>


    <!-- WORKING AREA -->
    <div id="main" style="position: relative;">
        <div [ngStyle]="{'width': newProceedingsWidth}" style="float:right;"
             [@expandLeft]="sidebarExpand"

             (mousedown)="dragBorder($event, 'left')" (mousemove)="dragBorder($event, 'left')"
             (mouseup)="dragBorder($event, 'left')" (mouseenter)="dragBorder($event, 'left')"
             (mouseleave)="dragBorder($event, 'left')"
             [ngClass]="{
                                    'dragborder': dragborder === 'active' || dragborder === 'dragging'
                                }"

             (blur)="onBlur($event)"
        >
            <app-proceedings [taskList]="taskService.taskList"
                             [operations]="taskService.operations"
                             (afterdrop)="onAfterDrop($event)" #proceedings
                             (operationclick)="onOperationClick($event)"
                             (operationhover)="onOperationHover($event)"
                             [queue]="taskService.preprocessor.queue"
                             [shortstyle]="sidebarExpand === 'closed'"

                             style="height:100%"
                             #proceedings
            >
            </app-proceedings>
        </div>
        <div [hidden]="dragborder === 'inactive'"
             [ngStyle]="{'margin-left': newProceedingsWidth, 'width': newToolWidth}"
             style="position:absolute; height:100%;z-index:800;"
             [@comeIn]="sidebarExpand"
             (mousedown)="dragBorder($event, 'right')" (mousemove)="dragBorder($event, 'right')"
             (mouseup)="dragBorder($event, 'right')" (mouseenter)="dragBorder($event, 'right')"
             (mouseleave)="dragBorder($event, 'right')"
             [ngClass]="{
                                    'dragborder': dragborder === 'active' || dragborder === 'dragging'
                                }"
        ></div>
        <div [ngStyle]="{'margin-left': newProceedingsWidth, 'width': newToolWidth}"
             style="position:absolute; height:100%;"
             [@comeIn]="sidebarExpand">
            <app-tool-loader [url]="tool_url" style="height:100%;"
                             [operation]="selectedOperation"
                             (datareceived)="onToolDataReceived($event)"
            ></app-tool-loader>
        </div>
        <div class="clearfix"></div>
    </div>
    <app-protocol-footer #protocolFooter></app-protocol-footer>
</div>