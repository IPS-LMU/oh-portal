<ng-template #splitModal let-c="close" let-d="dismiss">
    <div class="modal-header">
        <h4 class="modal-title">Audio files with more than 2 Channels</h4>
    </div>
    <div class="modal-body split-modal">
        <p>You have added audio files with more than two channels. In order to continue the channels will be split in
            separate files
            and each could be processed separately.
        </p>
        <p style="text-align: center;">
            What would you like to do?
        </p>
        <div class="row">
            <div class="col-4">
                <button class="btn btn-info" (click)="splitModalDismissedProperly = true; d('FIRST');">Always<br/>use 1.
                    channel
                </button>
            </div>
            <div class="col-4">
                <button class="btn btn-info" (click)="splitModalDismissedProperly = true; d('SECOND');">Always<br/>use
                    2. channel
                </button>
            </div>
            <div class="col-4">
                <button class="btn btn-info" (click)="splitModalDismissedProperly = true; d('BOTH');">Always<br/>use
                    both channels
                </button>
            </div>
        </div>
    </div>
</ng-template>

<ng-template #firstModal let-onfirstModalDismissed="dismiss">
    <div class="modal-header">
        <h4 class="modal-title">Notice</h4>
    </div>
    <div class="modal-body split-modal">
        <p> Please notice:</p>
        <ol>
            <li>
                Please do not close this tab or browser window. The processes are running only while this web
                application is opened. If you use this app on a laptop you need to keep the laptop opened while
                processing.
            </li>
            <li>After closing and re-opening this page you can only continue cancelled tasks from the last finished
                step.
            </li>
            <li>
                Your proceedings will be saved to your browser locally and automatically, but the results will be saved
                to the server for 24 hours. Please make sure to download your results in this time.
            </li>
        </ol>
        <div class="row">
            <div class="col-12">
                <button class="btn btn-info" (click)="firstModalShown = true; onfirstModalDismissed();">
                    I understand
                </button>
            </div>
        </div>
    </div>
</ng-template>

<div id="app" (dragover)="onMissedDrop($event)" (drop)="onMissedDrop($event)">
    <div class='row proceedings-header' style="background-color: transparent; padding-bottom: 0px;">
        <div class="col-4" style="text-align: center;"><span class="logo">OH-Portal</span> <span class="version">v{{AppInfo.version}}</span>
            <span *ngIf="isdevelopment"
                  style="color:red;">
        in development
         </span></div>
        <div class="col-4 status-div" style="background-color: ghostwhite;">
            <div class="status">
                <ng-container *ngIf="taskService.countRunningTasks() > 0">
                    {{taskService.countRunningTasks()}} Task(s) running...
                </ng-container>
                <ng-container *ngIf="taskService.countRunningTasks() < 1">
                    Ready for processing
                </ng-container>
            </div>
        </div>
        <div class="col-4" style="text-align: center; vertical-align: middle;">
            <div class="row">
                <div class="col-md-8" style="text-align: left; margin-top:14px;">
                    <a style="text-align: left; vertical-align: middle;margin-top:20px;"
                       [href]="taskService.protocolURL" [attr.download]="taskService.protocolFileName"><i
                            class="fa fa-file-code-o"></i> Data</a>
                </div>
                <div class="col-md-4">
                    <i class="fa fa-bell-o" aria-hidden="true" *ngIf="notification.permissionGranted"
                       (click)="notification.permissionGranted = false"></i>
                    <i class="fa fa-bell-slash-o" aria-hidden="true" *ngIf="!notification.permissionGranted"
                       (click)="notification.permissionGranted = true"></i>
                </div>
            </div>
        </div>
    </div>
    <div class='row proceedings-header' style="padding-top:0;" *ngIf="!showtool">
        <div class="col-8" style="text-align: left;border-top: 1px solid cornflowerblue;padding-top:5px;">
            <button class="btn btn-primary" (click)="onFilesAddButtonClicked()">
                <i class="fa fa-plus"></i> <span class="d-none d-lg-inline d-xl-inline">ADD FILES</span>
            </button>
            <!-- webkitdirectory directory multiple -->
            <input type="file" multiple class="fileinput" value="Select audio file"
                   style="display:none;"
                   #fileinput
                   (change)="onFileChange($event)"/>

            <button class="btn dropdown-toggle" type="button" id="dropdownMenuButton"
                    style="background-color: transparent;"
                    data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                <ng-container *ngIf="taskService.selectedlanguage === null">
                    {{AppInfo.languages[0].code | uppercase}}
                    ({{getShortCode(AppInfo.languages[0].code)}}) [{{AppInfo.languages[0].asr}}]
                </ng-container>
                <ng-container *ngIf="taskService.selectedlanguage !== null">
                    {{taskService.selectedlanguage.name}} ({{getShortCode(taskService.selectedlanguage.code)}})
                    [{{taskService.selectedlanguage.asr}}]
                </ng-container>
            </button>
            <div class="dropdown-menu" aria-labelledby="dropdownMenuButton">
                                    <span class="dropdown-item" *ngFor="let lang of AppInfo.languages; let i = index;"
                                          (click)="onASRLangCHanged(lang)">
                                        <ng-container
                                                *ngIf="!(taskService.selectedlanguage === null && i === 0) && (taskService.selectedlanguage !== lang.code)">
                                            {{lang.name}} ({{getShortCode(lang.code)}}) [{{lang.asr}}]
                                        </ng-container>
                                    </span>
            </div>
        </div>
        <div class="col-4" style="text-align:right;border-top: 1px solid cornflowerblue;padding-top:5px;">
            <button class="btn btn-primary" (click)="onUploadButtonClick()"
                    [disabled]="!taskService.newfiles">
                <i class="fa fa-cloud-upload" aria-hidden="true"></i> <span
                    class="d-none d-lg-inline d-xl-inline">UPLOAD & PROCESS FILES</span>
            </button>
        </div>
    </div>
    <div class='row proceedings-header' style="padding-top:0px; border-top: 1px solid cornflowerblue; height:50px;"
         *ngIf="showtool">
        <div class="col-2" style="text-align: left;padding-top:5px;">
            <button class="btn btn-primary" (click)="onBackButtonClicked();" style="width:100%;">
                <i class="fa fa-angle-double-left" aria-hidden="true" style="font-size:20px;"></i>
            </button>
        </div>
        <div class="col-8" style="text-align: center;">
            <p style="margin:0px; margin-top:10px;">
                <ng-container *ngIf="selectedOperation.previousOperation.results.length > 0">
                    {{selectedOperation.name}}: {{selectedOperation.previousOperation.results[0].fullname}}

                    , Language: {{selectedOperation.task.language}}

                    , Audio duration: {{getTime() |time}}

                </ng-container>
                <ng-container *ngIf="selectedOperation.previousOperation.results.length < 1">
                    {{selectedOperation.name}}:
                    {{selectedOperation.previousOperation.previousOperation.results[0].fullname}}

                    , Language: {{selectedOperation.task.language}}

                    , Audio duration: {{getTime() | time}}
                </ng-container>
            </p>
        </div>
        <div class="col-2" style="text-align:right;padding-top:5px;">
            <button class="btn btn-primary" (click)="onBackButtonClicked();" style="width:100%;">
                <i class="fa fa-angle-double-left" aria-hidden="true" style="font-size:20px;"></i>
            </button>
        </div>
    </div>
    <div class="row main-row">
        <div *ngIf="sidebarstate !== 'hidden'" [ngClass]="{
            'col-3': sidebarstate !== 'hidden'
        }" id="sidebar">
            <app-proceedings style="height:100%; display:flex; flex-direction:column; flex:auto;"
                             [taskList]="taskService.taskList"
                             [operations]="taskService.operations"
                             [shortstyle]="true"
                             (afterdrop)="onAfterDrop($event)" #proceedings
                             (operationclick)="onOperationClick($event)"
                             [queue]="taskService.preprocessor.queue"
            ></app-proceedings>
        </div>
        <div [ngClass]="{
        'col-9': sidebarstate !== 'hidden',
        'col-12': sidebarstate === 'hidden'
    }" style="height:100%;" id="upper-main">
            <div id="main">
                <ng-container *ngIf="showtool; else showProceedings">
                    <app-tool-loader [url]="tool_url" style="height:100%;" [operation]="selectedOperation"
                                     (datareceived)="onToolDataReceived($event)"></app-tool-loader>
                </ng-container>
                <ng-template #showProceedings>
                    <app-proceedings style="display:flex; flex:auto;" [taskList]="taskService.taskList"
                                     [operations]="taskService.operations"
                                     (afterdrop)="onAfterDrop($event)" #proceedings
                                     (operationclick)="onOperationClick($event)"
                                     (operationhover)="onOperationHover($event)"
                                     [queue]="taskService.preprocessor.queue"
                                     #proceedings
                    ></app-proceedings>
                    <div id="protocol-table" [@expandToggle]="tag.getAttribute('data-state')">
                        <div class="protocol-header">
                            <div class="info">
                                <table>
                                    <tbody>
                                    <tr>
                                        <td (click)="onProtoclLabelClick(tag)" style="padding: 5px;cursor: pointer;">
                                            <span class="text-danger">{{taskService.errors_count}}</span> Errors
                                        </td>
                                        <td (click)="onProtoclLabelClick(tag)" style="padding: 5px;cursor: pointer;">
                                            <span class="text-warning">{{taskService.warnings_count}}</span> Warnings
                                        </td>
                                    </tr>
                                    </tbody>
                                </table>
                            </div>
                            <div class="tag"><i class="fa fa-angle-down" aria-hidden="true" appExpand #tag
                                                style="cursor:pointer;color:#005cbf;"></i></div>
                        </div>
                        <div class="protocol-body" [ngStyle]="{
                        display: ((tag.getAttribute('data-state') !== 'opened') ? 'none': 'flex')
                    }">
                            <table class="table table-bordered">
                                <tbody>
                                <tr *ngFor="let elem of taskService.protocol_array">
                                    <td>{{elem.task_id}}</td>
                                    <td>
                                        <i *ngIf="elem.state === 'ERROR'" class="fa fa-exclamation"
                                           style="color:red"></i>
                                        <i *ngIf="elem.state === 'FINISHED'" class="fa fa-warning"
                                           style="color:orange"></i>
                                    </td>
                                    <td>{{elem.op_name}}</td>
                                    <td>{{elem.protocol}}</td>
                                </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </ng-template>
            </div>
        </div>
    </div>
</div>