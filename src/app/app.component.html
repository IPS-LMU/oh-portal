<app-feedback #feedbackModal></app-feedback>
<app-first-modal #firstModal></app-first-modal>
<app-split-modal #splitModal></app-split-modal>
<app-queue-modal #queueModal *ngIf="taskService.taskList !== undefined" [tasks]="taskService.taskList.getAllTasks()"
                 [queue]="taskService.preprocessor.queue"
                 [operations]="taskService.operations"></app-queue-modal>
<app-statistics #statisticsModal></app-statistics>
<app-alert></app-alert>
<div id="app" (dragover)="onMissedDrop($event)" (drop)="onMissedDrop($event)" [hidden]="!settingsService.allLoaded">
    <nav class="navbar navbar-expand-md navbar-light bg-white fixed-top">
        <div class="container justify-content-center" style="width:100%;margin:0;display: contents;">
            <ul class="nav navbar-nav flex-fill w-100 flex-nowrap">
                <li class="nav-item active">
                    <a class="nav-link" href="#" [title]="AppInfo.lastUpdated| date:'dd.MM.yyyy H:mm z'"><span
                            class="logo">OH-Portal</span> <span class="version"> v{{AppInfo.version}}</span>
                        <span *ngIf="isdevelopment"
                              style="color:red;">
                Beta
            </span>
                        <button class="navbar-toggler" type="button" data-toggle="collapse"
                                data-target=".dual-collapse2" (click)="isCollapsed = !isCollapsed">
                            <span class="navbar-toggler-icon"></span>
                        </button>
                    </a>
                </li>
            </ul>
            <div class="navbar-collapse collapse w-100 order-1 order-md-0 dual-collapse2" [collapse]="!isCollapsed">
                <ul class="nav navbar-nav flex-fill justify-content-center state-icons" style="min-width:300px;">
                    <li class="nav-item">
                        <div class="totalState" [tooltip]="queuedTipp"
                             containerClass="state-tooltip"
                             placement="bottom">
                            <div class="number">{{taskService.statistics.queued}}</div>
                            <i class="fa fa-database" style="color:gray;"></i>
                            <ng-template #queuedTipp>{{taskService.statistics.queued}} audio files are waiting for
                                verification.
                            </ng-template>
                        </div>
                        <div class="totalState" [tooltip]="waitingTipp"
                             containerClass="state-tooltip" placement="bottom">
                            <div class="number">{{taskService.statistics.waiting}}</div>
                            <i class="fa fa-clock-o" style="color:dodgerblue;"></i>
                            <ng-template #waitingTipp>{{taskService.statistics.waiting}} tasks are waiting for
                                processing.
                            </ng-template>
                        </div>
                        <div class="totalState" [tooltip]="runningTipp"
                             containerClass="state-tooltip" placement="bottom">
                            <div class="number">{{taskService.statistics.running}}</div>
                            <i [ngClass]="{
                        'fa-spin': (taskService.statistics.running > 0)
                    }" class="fa fa-cog" style="color:orange;"></i>
                            <ng-template #runningTipp>{{taskService.statistics.running}} tasks are running.
                            </ng-template>
                        </div>
                        <div class="totalState" [tooltip]="finishedTipp"
                             containerClass="state-tooltip" placement="bottom">
                            <div class="number">{{taskService.statistics.finished}}</div>
                            <i class="fa fa-check" style="color:forestgreen;"></i>
                            <ng-template #finishedTipp>{{taskService.statistics.finished}} tasks are finished.
                            </ng-template>
                        </div>
                        <div class="totalState" [tooltip]="errorsTipp"
                             containerClass="state-tooltip" placement="bottom">
                            <div class="number">{{taskService.statistics.errors}}</div>
                            <i class="fa fa-times" style="color:red;"></i>
                            <ng-template #errorsTipp>{{taskService.statistics.errors}} tasks failed. For further details
                                please hover over the red "X" icon in a column.
                            </ng-template>
                        </div>
                    </li>
                </ul>
            </div>
            <div class="navbar-collapse collapse w-100 order-1 order-md-0 dual-collapse2" [collapse]="!isCollapsed">
                <ul class="nav navbar-nav flex-fill w-100 justify-content-end right-icons">
                    <li class="nav-item active">
                        <a style="text-align: left; vertical-align: middle;margin-top:20px; cursor: pointer;"
                           href="https://www.phonetik.uni-muenchen.de/apps/oh-portal/contents/v1.0.0/help.html"
                           target="_blank"><i
                                class="fa fa-question-circle-o" style="color:cornflowerblue;"></i> Help</a>
                    </li>
                    <li class="nav-item active" style="cursor: pointer;">
                    <span style="text-align: left; vertical-align: middle;margin-top:20px; cursor: pointer;"
                          (click)="statisticsModal.open();"><i
                            class="fa fa-line-chart"></i> Statistics</span>
                    </li>
                    <li class="nav-item active" (click)="feedbackModal.open()">
                        <i class="fa fa-exclamation-circle" [ngClass]="{
                        'yellow': !bugService.hasErrors,
                        'red': bugService.hasErrors
                        }"></i><span style="cursor: pointer;"> Feedback</span>
                    </li>
                    <li class="nav-item active">
                        <i class="fa fa-bell-o" aria-hidden="true" *ngIf="notification.permissionGranted"
                           (click)="notification.permissionGranted = false" style="cursor: pointer;"></i>
                        <i class="fa fa-bell-slash-o" aria-hidden="true" *ngIf="!notification.permissionGranted"
                           (click)="notification.permissionGranted = true" style="cursor: pointer;"></i>
                    </li>
                    <li class="nav-item active">
                        <div class="btn-group" dropdown>
                            <i class="fa fa-cog" dropdownToggle id="dropdownBasic2" style="cursor: pointer;"></i>

                            <div *dropdownMenu class="dropdown-menu" id="settings-dropdown" role="menu">
                                <table style="width:100%;">
                                    <tbody>
                                    <tr>
                                        <td><i class="fa fa-columns"></i></td>
                                        <td><span class="btn-link" style="cursor: pointer;"
                                                  (click)="resetSideBarWidth();">Reset sidebar width</span></td>
                                    </tr>
                                    <tr>
                                        <td style="padding-top:20px;"><i class="fa fa-eraser" style="color:red;"></i>
                                        </td>
                                        <td style="padding-top:20px;"><span class="btn-link"
                                                                            style="cursor: pointer;color:red;"
                                                                            (click)="onClearClick();">Clear all data</span>
                                        </td>
                                    </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </li>
                </ul>
            </div>
        </div>
    </nav>
    <!-- SUB-HEADER OVERVIEW -->
    <div class='row proceedings-header' style="padding-top:0;" *ngIf="!showtool">
        <div class="col-4" style="text-align: left;padding-top:5px;">
            <button class="btn btn-primary" (click)="onFilesAddButtonClicked()">
                <i class="fa fa-plus"></i><span class="d-none d-lg-inline d-xl-inline"> 1. ADD FILES</span>
            </button>
            <!-- webkitdirectory directory multiple -->
            <input type="file" multiple class="fileinput" value="Select audio file"
                   style="display:none;"
                   #fileinput
                   (change)="onFileChange($event)"/>

            <button class="btn btn-primary" style="margin-left:10px;" [disabled]="taskService.statistics.queued < 1"
                    (click)="onVerifyButtonClick()"><i class="fa fa-database"></i> <span
                    class="d-none d-lg-inline d-xl-inlin"> 2. VERIFY</span>
                <ng-container *ngIf="taskService.statistics.queued > 0">
                    ({{taskService.statistics.queued}})
                </ng-container>
            </button>
        </div>
        <div class="col-4">
            <div id="overall-state">
                {{taskService.stateLabel}}
            </div>
        </div>
        <div class="col-4" style="text-align:right;padding-top:5px;">
            <button class="btn btn-primary" [disabled]="!taskService.newfiles" (click)="onStartClick()">
                <i class="fa" [ngClass]="{
                    'fa-play': !taskService.isProcessing,
                    'fa-stop': taskService.isProcessing
                }" aria-hidden="true"></i><span class="d-none d-lg-inline d-xl-inline">
                <ng-container *ngIf="!taskService.isProcessing">
                     3. START PROCESSING
                </ng-container>
                 <ng-container *ngIf="taskService.isProcessing">
                     3. STOP PROCESSING
                </ng-container>
            </span>
            </button>
        </div>
    </div>

    <!-- SUB-HEADER TOOL -->
    <div class='row proceedings-header' style="padding-top:0; height:50px;"
         *ngIf="showtool">
        <div class="col-2" style="text-align: left;padding-top:5px;">
            <button class="btn btn-primary" (click)="onBackButtonClicked();" style="width:100%;">
                <i class="fa fa-angle-double-left" aria-hidden="true" style="font-size:20px;"></i>
            </button>
        </div>
        <div class="col-8" style="text-align: center;">
            <p style="margin: 10px 0 0;">
                <ng-container *ngIf="toolSelectedOperation.previousOperation.results.length > 0">
                    {{toolSelectedOperation.name}}: {{toolSelectedOperation.previousOperation.results[0].fullname}}

                    , Language: {{toolSelectedOperation.task.language}}

                    , Audio duration: {{getTime() |time}}

                </ng-container>
                <ng-container *ngIf="toolSelectedOperation.previousOperation.results.length < 1">
                    {{toolSelectedOperation.name}}:
                    {{toolSelectedOperation.previousOperation.previousOperation.results[0].fullname}}

                    , Language: {{toolSelectedOperation.task.language}}

                    , Audio duration: {{getTime() | time}}
                </ng-container>
            </p>
        </div>
        <div class="col-2" style="text-align:right;padding-top:5px;">
            <button class="btn btn-primary" (click)="onBackButtonClicked();" style="width:100%;">
                <i class="fa fa-angle-double-left" aria-hidden="true" style="font-size:20px;"></i>
            </button>
        </div>
    </div>

    <!-- WORKING AREA -->
    <div id="main" style="position: relative;">
        <div [ngStyle]="{
            'width': newProceedingsWidth + '%',
            'border-right': (sidebarExpand === 'closed') ? '2px solid lightgray' : 'none'
        }" style="float:right;"
             [@expandLeft]="animationObject2"

             (mousedown)="dragBorder($event, 'left')" (mousemove)="dragBorder($event, 'left')"
             (mouseup)="dragBorder($event, 'left')" (mouseenter)="dragBorder($event, 'left')"
             (mouseleave)="dragBorder($event, 'left')"
             [ngClass]="{
                                    'dragborder': dragborder === 'active' || dragborder === 'dragging'
                                }"

             (blur)="onBlur($event)"
        >
            <app-proceedings *ngIf="settingsService.allLoaded && taskService.taskList !== undefined"
                             [taskList]="taskService.taskList"
                             [operations]="taskService.operations"
                             (afterdrop)="onAfterDrop($event)"
                             (operationclick)="onOperationClick($event)"
                             (operationhover)="onOperationHover($event)"
                             [queue]="taskService.preprocessor.queue"
                             [shortstyle]="sidebarstate === 'opened'"
                             [isClosed]="sidebarExpand === 'closed'"
                             (feedbackRequested)="onFeedbackRequest($event)"
                             style="height:100%"
                             #proceedings
            >
            </app-proceedings>
        </div>
        <div [hidden]="dragborder === 'inactive'"
             [ngStyle]="{'margin-left': newProceedingsWidth + '%', 'width': newToolWidth + '%'}"
             style="position:absolute; height:100%;z-index:800;"
             [@comeIn]="animationObject"
             (mousedown)="dragBorder($event, 'right')" (mousemove)="dragBorder($event, 'right')"
             (mouseup)="dragBorder($event, 'right')" (mouseenter)="dragBorder($event, 'right')"
             (mouseleave)="dragBorder($event, 'right')"
             [ngClass]="{
                                    'dragborder': dragborder === 'active' || dragborder === 'dragging'
                                }"
        ></div>
        <div [ngStyle]="{'margin-left': newProceedingsWidth + '%', 'width': newToolWidth + '%'}"
             style="position:absolute; height:100%; border-top: 1px solid gray;"
             [@comeIn]="animationObject">
            <app-tool-loader #toolLoader style="height:100%;"
                             [operation]="toolSelectedOperation"
                             (datareceived)="onToolDataReceived($event)"
            ></app-tool-loader>
        </div>
        <div class="clearfix"></div>
    </div>
</div>