<app-feedback #feedbackModal></app-feedback>
<app-first-modal #firstModal></app-first-modal>
<app-split-modal #splitModal></app-split-modal>
<app-queue-modal #queueModal [tasks]="taskService.taskList.getAllTasks()" [queue]="taskService.preprocessor.queue"
                 [operations]="taskService.operations"></app-queue-modal>
<app-statistics #statisticsModal></app-statistics>
<app-alert></app-alert>
<div id="app" (dragover)="onMissedDrop($event)" (drop)="onMissedDrop($event)">
    <nav class="navbar navbar-expand-md navbar-light fixed-top bg-white">
        <a class="navbar-brand" href="#">
            <span class="logo">OH-Portal</span> <span class="version"> v{{AppInfo.version}}</span>
            <span *ngIf="isdevelopment"
                  style="color:red;">
                Beta
            </span>
        </a>
        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarColor03"
                aria-controls="navbarColor03" [attr.aria-expanded]="!isCollapsed" aria-label="Toggle navigation"
                (click)="isCollapsed = !isCollapsed">
            <span class="navbar-toggler-icon"></span>
        </button>

        <div class="collapse navbar-collapse" id="navbarColor03" [ngbCollapse]="isCollapsed">
            <ul class="navbar-nav mx-auto mr-2 state-icons">
                <li class="nav-item">
                    <div class="number">{{taskService.countQueuedTasks()}}</div>
                    <i title="queued items" class="fa fa-database" style="color:gray;"></i>

                    <div class="number">{{taskService.countWaitingTasks()}}</div>
                    <i title="waiting tasks" class="fa fa-clock-o" style="color:dodgerblue;"></i>

                    <div class="number">{{taskService.countRunningTasks()}}</div>
                    <i title="running tasks" [ngClass]="{
                        'fa-spin': (taskService.countRunningTasks() > 0)
                    }" class="fa fa-cog" style="color:orange;"></i>

                    <div class="number">{{taskService.countFinishedTasks()}}</div>
                    <i title="finished tasks" class="fa fa-check" style="color:forestgreen;"></i>

                    <div class="number">{{taskService.errors_count}}</div>
                    <i title="failed tasks" class="fa fa-times" style="color:red;"></i>
                </li>
            </ul>
            <ul class="navbar-nav mr-sm-2 right-icons">
                <li class="nav-item active">
                    <span style="text-align: left; vertical-align: middle;margin-top:20px; cursor: pointer;"
                          (click)="statisticsModal.open();"><i
                            class="fa fa-line-chart"></i> Statistics</span>
                </li>
                <li class="nav-item active" (click)="feedbackModal.open()">
                    <i class="fa fa-exclamation-circle" [ngClass]="{
                        'yellow': !bugService.hasErrors,
                        'red': bugService.hasErrors
                        }"></i>
                </li>
                <li class="nav-item active">
                    <i class="fa fa-bell-o" aria-hidden="true" *ngIf="notification.permissionGranted"
                       (click)="notification.permissionGranted = false"></i>
                    <i class="fa fa-bell-slash-o" aria-hidden="true" *ngIf="!notification.permissionGranted"
                       (click)="notification.permissionGranted = true"></i>
                </li>
                <li class="nav-item active">
                    <div ngbDropdown placement="bottom-right" class="d-inline-block">
                        <i class="fa fa-cog" ngbDropdownToggle id="dropdownBasic2"></i>
                        <div ngbDropdownMenu aria-labelledby="dropdownBasic2" style="width:300px;right:0;padding:10px;">
                            <table style="width:100%;">
                                <tbody>
                                <tr>
                                    <td><i class="fa fa-columns"></i></td>
                                    <td><span class="btn-link" style="cursor: pointer;"
                                              (click)="resetSideBarWidth();">Reset sidebar width</span></td>
                                </tr>
                                <tr>
                                    <td style="padding-top:20px;"><i class="fa fa-eraser" style="color:red;"></i></td>
                                    <td style="padding-top:20px;"><span class="btn-link"
                                                                        style="cursor: pointer;color:red;"
                                                                        (click)="onClearClick();">Clear all data</span>
                                    </td>
                                </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </li>
            </ul>
        </div>
    </nav>

    <!-- SUB-HEADER OVERVIEW -->
    <div class='row proceedings-header' style="padding-top:0;" *ngIf="!showtool">
        <div class="col-4" style="text-align: left;border-top: 1px solid cornflowerblue;padding-top:5px;">
            <button class="btn btn-primary" (click)="onFilesAddButtonClicked()">
                <i class="fa fa-plus"></i><span class="d-none d-lg-inline d-xl-inline"> 1. ADD FILES</span>
            </button>
            <!-- webkitdirectory directory multiple -->
            <input type="file" multiple class="fileinput" value="Select audio file"
                   style="display:none;"
                   #fileinput
                   (change)="onFileChange($event)"/>

            <button class="btn btn-primary" style="margin-left:10px;" [disabled]="taskService.countQueuedTasks() < 1"
                    (click)="onVerifyButtonClick()"><i class="fa fa-database"></i> <span
                    class="d-none d-lg-inline d-xl-inlin"> 2. VERIFY</span>
                <ng-container *ngIf="taskService.countQueuedTasks() > 0">
                    ({{taskService.countQueuedTasks()}})
                </ng-container>
            </button>
        </div>
        <div class="col-4">
            <div id="overall-state">
                {{taskService.stateLabel}}
            </div>
        </div>
        <div class="col-4" style="text-align:right;border-top: 1px solid cornflowerblue;padding-top:5px;">
            <button class="btn btn-primary" [disabled]="!taskService.newfiles" (click)="onStartClick()">
                <i class="fa" [ngClass]="{
                    'fa-play': !taskService.isProcessing,
                    'fa-stop': taskService.isProcessing
                }" aria-hidden="true"></i><span class="d-none d-lg-inline d-xl-inline">
                <ng-container *ngIf="!taskService.isProcessing">
                     3. START PROCESSING
                </ng-container>
                 <ng-container *ngIf="taskService.isProcessing">
                     3. STOP PROCESSING
                </ng-container>
            </span>
            </button>
        </div>
    </div>

    <!-- SUB-HEADER TOOL -->
    <div class='row proceedings-header' style="padding-top:0px; border-top: 1px solid cornflowerblue; height:50px;"
         *ngIf="showtool">
        <div class="col-2" style="text-align: left;padding-top:5px;">
            <button class="btn btn-primary" (click)="onBackButtonClicked();" style="width:100%;">
                <i class="fa fa-angle-double-left" aria-hidden="true" style="font-size:20px;"></i>
            </button>
        </div>
        <div class="col-8" style="text-align: center;">
            <p style="margin:0px; margin-top:10px;">
                <ng-container *ngIf="toolSelectedOperation.previousOperation.results.length > 0">
                    {{toolSelectedOperation.name}}: {{toolSelectedOperation.previousOperation.results[0].fullname}}

                    , Language: {{toolSelectedOperation.task.language}}

                    , Audio duration: {{getTime() |time}}

                </ng-container>
                <ng-container *ngIf="toolSelectedOperation.previousOperation.results.length < 1">
                    {{toolSelectedOperation.name}}:
                    {{toolSelectedOperation.previousOperation.previousOperation.results[0].fullname}}

                    , Language: {{toolSelectedOperation.task.language}}

                    , Audio duration: {{getTime() | time}}
                </ng-container>
            </p>
        </div>
        <div class="col-2" style="text-align:right;padding-top:5px;">
            <button class="btn btn-primary" (click)="onBackButtonClicked();" style="width:100%;">
                <i class="fa fa-angle-double-left" aria-hidden="true" style="font-size:20px;"></i>
            </button>
        </div>
    </div>

    <!-- WORKING AREA -->
    <div id="main" style="position: relative;">
        <div [ngStyle]="{
            'width': newProceedingsWidth + '%',
            'border-right': (sidebarExpand === 'closed') ? '2px solid lightgray' : 'none'
        }" style="float:right;"
             [@expandLeft]="animationObject2"

             (mousedown)="dragBorder($event, 'left')" (mousemove)="dragBorder($event, 'left')"
             (mouseup)="dragBorder($event, 'left')" (mouseenter)="dragBorder($event, 'left')"
             (mouseleave)="dragBorder($event, 'left')"
             [ngClass]="{
                                    'dragborder': dragborder === 'active' || dragborder === 'dragging'
                                }"

             (blur)="onBlur($event)"
        >
            <app-proceedings [taskList]="taskService.taskList"
                             [operations]="taskService.operations"
                             (afterdrop)="onAfterDrop($event)" #proceedings
                             (operationclick)="onOperationClick($event)"
                             (operationhover)="onOperationHover($event)"
                             [queue]="taskService.preprocessor.queue"
                             [shortstyle]="sidebarExpand === 'closed'"
                             style="height:100%"
                             #proceedings
            >
            </app-proceedings>
        </div>
        <div [hidden]="dragborder === 'inactive'"
             [ngStyle]="{'margin-left': newProceedingsWidth + '%', 'width': newToolWidth + '%'}"
             style="position:absolute; height:100%;z-index:800;"
             [@comeIn]="animationObject"
             (mousedown)="dragBorder($event, 'right')" (mousemove)="dragBorder($event, 'right')"
             (mouseup)="dragBorder($event, 'right')" (mouseenter)="dragBorder($event, 'right')"
             (mouseleave)="dragBorder($event, 'right')"
             [ngClass]="{
                                    'dragborder': dragborder === 'active' || dragborder === 'dragging'
                                }"
        ></div>
        <div [ngStyle]="{'margin-left': newProceedingsWidth + '%', 'width': newToolWidth + '%'}"
             style="position:absolute; height:100%; border-top: 1px solid gray;"
             [@comeIn]="animationObject">
            <app-tool-loader #toolLoader style="height:100%;"
                             [operation]="toolSelectedOperation"
                             (datareceived)="onToolDataReceived($event)"
            ></app-tool-loader>
        </div>
        <div class="clearfix"></div>
    </div>
</div>